local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local rootPart = nil

-- KONFIGURASI
local TARGET_NAME = "AmberRock"
local MOVE_SPEED = 200 -- Speed tween
local MAX_DISTANCE = 1000 -- Jarak maksimum untuk auto collect
local ESP_COLOR = Color3.fromRGB(255, 170, 0)

local espEnabled = false
local autoCollectEnabled = false
local collecting = false

-- GUI
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "AmberGUI"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 120)
frame.Position = UDim2.new(0.5, -100, 0.5, -60)
frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
frame.BackgroundTransparency = 0.3
frame.Active = true
frame.Selectable = true
frame.Draggable = false
frame.Parent = gui

-- Geser GUI Mobile
local dragging, dragStart, startPos
frame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = frame.Position
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

frame.InputChanged:Connect(function(input)
	if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
		local delta = input.Position - dragStart
		frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
end)

-- Tombol GUI
local espBtn = Instance.new("TextButton", frame)
espBtn.Size = UDim2.new(1, 0, 0.33, 0)
espBtn.Position = UDim2.new(0, 0, 0, 0)
espBtn.Text = "üî≤ ESP: OFF"
espBtn.BackgroundTransparency = 1
espBtn.TextColor3 = Color3.new(1, 1, 1)
espBtn.TextScaled = true

local autoBtn = Instance.new("TextButton", frame)
autoBtn.Size = UDim2.new(1, 0, 0.33, 0)
autoBtn.Position = UDim2.new(0, 0, 0.33, 0)
autoBtn.Text = "‚öôÔ∏è AutoCollect: OFF"
autoBtn.BackgroundTransparency = 1
autoBtn.TextColor3 = Color3.new(1, 1, 1)
autoBtn.TextScaled = true

local hideBtn = Instance.new("TextButton", frame)
hideBtn.Size = UDim2.new(1, 0, 0.34, 0)
hideBtn.Position = UDim2.new(0, 0, 0.66, 0)
hideBtn.Text = "üîΩ Sembunyikan"
hideBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
hideBtn.TextColor3 = Color3.new(1, 1, 1)
hideBtn.TextScaled = true

-- Toggle GUI
espBtn.MouseButton1Click:Connect(function()
	espEnabled = not espEnabled
	espBtn.Text = espEnabled and "üü© ESP: ON" or "üî≤ ESP: OFF"
end)

autoBtn.MouseButton1Click:Connect(function()
	autoCollectEnabled = not autoCollectEnabled
	autoBtn.Text = autoCollectEnabled and "üü¢ AutoCollect: ON" or "‚öôÔ∏è AutoCollect: OFF"
end)

local isHidden = false
hideBtn.MouseButton1Click:Connect(function()
	isHidden = not isHidden
	espBtn.Visible = not isHidden
	autoBtn.Visible = not isHidden
	hideBtn.Text = isHidden and "üîº Tampilkan" or "üîΩ Sembunyikan"
end)

-- ESP
local function createESP(model)
	if model:FindFirstChild("ESPLabel") then return end
	local part = model:FindFirstChildWhichIsA("BasePart")
	if not part then return end

	local billboard = Instance.new("BillboardGui", model)
	billboard.Name = "ESPLabel"
	billboard.Size = UDim2.new(0, 100, 0, 30)
	billboard.Adornee = part
	billboard.AlwaysOnTop = true

	local label = Instance.new("TextLabel", billboard)
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.Text = model.Name
	label.TextColor3 = ESP_COLOR
	label.TextScaled = true
end

-- Interact
local function interactWithPrompt(model)
	for _, d in pairs(model:GetDescendants()) do
		if d:IsA("ProximityPrompt") then
			pcall(function()
				fireproximityprompt(d)
			end)
			break
		end
	end
end

-- Tween dan Interact
local function moveTo(model)
	local part = model:FindFirstChildWhichIsA("BasePart")
	if not part then return false end

	local rayOrigin = part.Position + Vector3.new(0, 5, 0)
	local rayDirection = Vector3.new(0, -100, 0)
	local params = RaycastParams.new()
	params.FilterDescendantsInstances = {model}
	params.FilterType = Enum.RaycastFilterType.Blacklist

	local result = workspace:Raycast(rayOrigin, rayDirection, params)
	local targetPos = result and result.Position + Vector3.new(0, 3, 0) or part.Position + Vector3.new(0, 3, 0)

	local dist = (rootPart.Position - targetPos).Magnitude
	local time = dist / MOVE_SPEED

	local tween = TweenService:Create(rootPart, TweenInfo.new(time, Enum.EasingStyle.Linear), {
		CFrame = CFrame.new(targetPos)
	})

	tween:Play()
	tween.Completed:Wait()

	for i = 1, 20 do
		interactWithPrompt(model)
		task.wait(0.1)
		if not model:IsDescendantOf(workspace) then
			return true
		end
	end

	return false
end

-- Main Loop
task.spawn(function()
	while true do
		if not rootPart or not rootPart:IsDescendantOf(workspace) then
			local char = player.Character or player.CharacterAdded:Wait()
			rootPart = char:WaitForChild("HumanoidRootPart")
		end

		if espEnabled then
			for _, obj in pairs(workspace:GetDescendants()) do
				if obj:IsA("Model") and obj.Name == TARGET_NAME then
					createESP(obj)
				end
			end
		end

		if autoCollectEnabled and not collecting then
			collecting = true
			local targets = {}

			for _, obj in pairs(workspace:GetDescendants()) do
				if obj:IsA("Model") and obj.Name == TARGET_NAME then
					local part = obj:FindFirstChildWhichIsA("BasePart")
					if part then
						local dist = (rootPart.Position - part.Position).Magnitude
						if dist <= MAX_DISTANCE then
							table.insert(targets, {model = obj, distance = dist})
						end
					end
				end
			end

			table.sort(targets, function(a, b)
				return a.distance < b.distance
			end)

			for _, target in ipairs(targets) do
				if autoCollectEnabled and target.model and target.model.Parent then
					local success = moveTo(target.model)
					if success then
						-- langsung lanjut ke yang berikutnya
					end
				end
			end

			collecting = false
		end

		task.wait(0.3)
	end
end)
